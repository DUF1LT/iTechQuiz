@using iTechArt.iTechQuiz.Domain.Models
@model iTechArt.iTechQuiz.Domain.Models.Survey

@section Styles
{
    <link rel="stylesheet" href="~/css/sidebar.css" />
    <link rel="stylesheet" href="~/css/new-survey.css" />
}

<partial name="_SidebarPartial" />
<div class="main-wrapper">
    <section class="new-survey-section">
        <div class="new-survey-main">
            <div class="new-survey-main__title">
                <span>New survey:</span>
                <input type="text" />
            </div>
            <span>Questions: , pages: </span>
            <div class="new-survey-main__buttons">
                <div class="new-survey-main__buttons-left">
                    <button class="button">Save</button>
                    <button class="lg-button">Save as template</button>
                    <button class="red-button">Cancel</button>
                </div>
                <button class="button">New page</button>
            </div>
            <div class="new-survey-main-constructor-wrapper">
                <div id="surveyConstructor" class="new-survey-main-constructor">
                    <input type="text" value="Page 1" />
                </div>
            </div>
        </div>
        <div class="new-survey-side">
            <div class="new-survey-side-wrapper">
                <div class="new-survey-side-question-type">
                    <div class="new-survey-side-question-type__title">
                        Question type
                    </div>
                    <div class="new-survey-side-question-type__options">
                        <div id="singleAnswerOption" class="new-survey-side-question-type__option"
                             draggable="true">
                            <img src="~/img/dotlist.svg" width="20" draggable="false" />
                            <span>Answer options (single)</span>
                        </div>
                        <div id="multipleAnswerOption" class="new-survey-side-question-type__option" draggable="true">
                            <img src="~/img/boxlist.svg" width="20" draggable="false" />
                            <span>Answer options (multiple)</span>
                        </div>
                        <div id="textAnswerOption" class="new-survey-side-question-type__option" draggable="true">
                            <img src="~/img/text.svg" width="20" draggable="false" />
                            <span draggable="true">Text</span>
                        </div>
                        <div id="fileAnswerOption" class="new-survey-side-question-type__option" draggable="true">
                            <img src="~/img/file.svg" width="20" draggable="false" />
                            <span draggable="true">File</span>
                        </div>
                        <div id="starAnswerOption" class="new-survey-side-question-type__option" draggable="true">
                            <img src="~/img/star.svg" width="20" draggable="false" />
                            <span draggable="true">Star rating</span>
                        </div>
                        <div id="scaleAnswerOption" class="new-survey-side-question-type__option" draggable="true">
                            <img src="~/img/scale.svg" width="20" draggable="false" />
                            <span draggable="true">Scale</span>
                        </div>
                    </div>
                </div>
                <div class="new-survey-side-survey-parameters">
                    <span class="new-survey-side-survey-parametrs__title">
                        Survey Parameters
                    </span>
                    <div class="new-survey-side-survey-parameters__options">
                        <div>
                            <input type="checkbox" />
                            <span>Anonymous</span>
                        </div>
                        <div>
                            <input type="checkbox" />
                            <span>Question numbers</span>
                        </div>
                        <div>
                            <input type="checkbox" />
                            <span>Questions in random sequence</span>
                        </div>
                        <div>
                            <input type="checkbox" />
                            <span>Render start at required questions</span>
                        </div>
                        <div>
                            <input type="checkbox" />
                            <span>Progress bar</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

@section Scripts
{
    @*<script src="~/js/draganddrop.js"></script>*@
    <script>
        const singleAnswerOption = document.getElementById("singleAnswerOption");
        const multipleAnswerOption = document.getElementById("multipleAnswerOption");
        const textAnswerOption = document.getElementById("textAnswerOption");
        const fileAnswerOption = document.getElementById("fileAnswerOption");
        const starAnswerOption = document.getElementById("starAnswerOption");
        const scaleAnswerOption = document.getElementById("scaleAnswerOption");

        const insertQuestion = htmlToElement(`@{await Html.RenderPartialAsync("Shared/_InsertQuestionPartial");}`);
        const singleAnswerHtml = `@{await Html.RenderPartialAsync("Shared/_SingleAnswerPartial");}`;

        function htmlToElement(html) {
            var template = document.createElement('template');
            template.innerHTML = html.trim();
            return template.content.firstChild;
        }

        const dropZone = document.getElementById("surveyConstructor");
        dropZone.addEventListener("dragover", event => {
            event.preventDefault();
        });

        dropZone.addEventListener("drop", event => {
            event.preventDefault();
            const data = event.dataTransfer.getData("text/html");
            dropZone.appendChild(htmlToElement(data));
        });

        singleAnswerOption.addEventListener("dragstart", event => {
            event.dataTransfer.setData("text/html", singleAnswerHtml);
            console.log(event);
            dropZone.appendChild(insertQuestion);
        });

        singleAnswerOption.addEventListener("dragend", event => {
            dropZone.removeChild(insertQuestion);
        });


    </script>
}